<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BB Grid V5 - Advanced Trading Monitor</title>
    
    <script src="https://cdn.jsdelivr.net/npm/lightweight-charts@4.1.0/dist/lightweight-charts.standalone.production.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }
        
        body {
            background: #0a0e17;
            color: #ffffff;
            overflow-x: hidden;
            min-height: 100vh;
        }
        
        .header {
            background: linear-gradient(135deg, #1a1f3a 0%, #0f1324 100%);
            padding: 18px 30px;
            border-bottom: 1px solid rgba(102, 126, 234, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 20px;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .status-badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .status-badge.online {
            background: rgba(16, 185, 129, 0.15);
            color: #10b981;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        
        .status-badge.offline {
            background: rgba(239, 68, 68, 0.15);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }
        
        .status-badge.connecting {
            background: rgba(245, 158, 11, 0.15);
            color: #f59e0b;
            border: 1px solid rgba(245, 158, 11, 0.3);
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #1a1f3a 0%, #2a2f4a 100%);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid rgba(102, 126, 234, 0.2);
            transition: transform 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.15);
        }
        
        .stat-card h3 {
            color: #8b92b0;
            font-size: 12px;
            text-transform: uppercase;
            margin-bottom: 8px;
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .stat-value.positive { color: #10b981; }
        .stat-value.negative { color: #ef4444; }
        .stat-value.neutral { color: #fff; }
        
        .chart-container {
            background: #1a1f3a;
            border-radius: 12px;
            margin: 20px;
            border: 1px solid rgba(102, 126, 234, 0.2);
            padding: 20px;
        }
        
        #tradingChart {
            height: 400px;
            width: 100%;
        }
        
        .trades-panel {
            background: #1a1f3a;
            border-radius: 12px;
            margin: 20px;
            border: 1px solid rgba(102, 126, 234, 0.2);
            padding: 20px;
        }
        
        .trade-item {
            background: #2a2f4a;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .trade-item.buy { border-left-color: #10b981; }
        .trade-item.sell { border-left-color: #ef4444; }
        
        .trade-type {
            padding: 5px 12px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
        }
        
        .trade-type.buy {
            background: rgba(16, 185, 129, 0.15);
            color: #10b981;
        }
        
        .trade-type.sell {
            background: rgba(239, 68, 68, 0.15);
            color: #ef4444;
        }
        
        .footer {
            text-align: center;
            padding: 20px;
            color: #8b92b0;
            font-size: 12px;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        @media (max-width: 768px) {
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body>

    <div class="header">
        <div class="logo">
            <span>ðŸ¤– BB Grid V5.0 - ML Trading Monitor</span>
        </div>
        <span class="status-badge connecting" id="statusBadge">
            <i class="fas fa-sync-alt fa-spin"></i> CONNECTING
        </span>
    </div>
    
    <div class="stats-grid">
        <div class="stat-card">
            <h3>ðŸ’° EQUITY</h3>
            <div class="stat-value neutral" id="equity">$0.00</div>
        </div>
        
        <div class="stat-card">
            <h3>ðŸ“Š BALANCE</h3>
            <div class="stat-value neutral" id="balance">$0.00</div>
        </div>
        
        <div class="stat-card">
            <h3>ðŸ’µ PROFIT/LOSS</h3>
            <div class="stat-value neutral" id="profit">$0.00</div>
        </div>
        
        <div class="stat-card">
            <h3>ðŸ“ˆ OPEN TRADES</h3>
            <div class="stat-value neutral" id="openTrades">0</div>
        </div>
        
        <div class="stat-card">
            <h3>ðŸ§  ML CONFIDENCE</h3>
            <div class="stat-value neutral" id="mlConfidence">0%</div>
            <div style="font-size: 11px; color: #8b92b0;">Trained: <span id="mlTrained">0</span>x</div>
        </div>
        
        <div class="stat-card">
            <h3>ðŸ“¡ STATUS</h3>
            <div class="stat-value neutral" id="connectionStatus">OFFLINE</div>
        </div>
    </div>
    
    <div class="chart-container">
        <h2 style="margin-bottom: 15px;">ðŸ“ˆ Live Chart - <span id="currentSymbol">Loading...</span></h2>
        <div id="tradingChart"></div>
    </div>
    
    <div class="trades-panel">
        <h2 style="margin-bottom: 15px;">Active Positions (<span id="tradeCount">0</span>)</h2>
        <div id="tradesList">
            <div style="text-align: center; color: #8b92b0; padding: 40px;">
                <i class="fas fa-box-open" style="font-size: 48px; margin-bottom: 10px;"></i><br>
                No active trades
            </div>
        </div>
    </div>
    
    <div class="footer">
        <div>Last Update: <span id="lastUpdate">--:--:--</span></div>
        <div>Â© 2025 BB Grid V5.0 ML - Advanced Trading Monitor</div>
    </div>
    
    <script>
        let chart = null;
        let candlestickSeries = null;
        let currentData = null;
        
        // Initialize Chart
        function initChart() {
            const chartContainer = document.getElementById('tradingChart');
            
            chart = LightweightCharts.createChart(chartContainer, {
                width: chartContainer.clientWidth,
                height: 400,
                layout: {
                    background: { color: '#0a0e17' },
                    textColor: '#D9D9D9',
                },
                grid: {
                    vertLines: { color: 'rgba(42, 46, 57, 0.5)' },
                    horzLines: { color: 'rgba(42, 46, 57, 0.5)' },
                },
                rightPriceScale: {
                    borderColor: 'rgba(42, 46, 57, 0.8)',
                },
                timeScale: {
                    borderColor: 'rgba(42, 46, 57, 0.8)',
                    timeVisible: true,
                },
            });
            
            candlestickSeries = chart.addCandlestickSeries({
                upColor: '#10b981',
                downColor: '#ef4444',
                borderDownColor: '#ef4444',
                borderUpColor: '#10b981',
                wickDownColor: '#ef4444',
                wickUpColor: '#10b981',
            });
            
            window.addEventListener('resize', () => {
                chart.applyOptions({ width: chartContainer.clientWidth });
            });
        }
        
        // Fetch Data from API
        async function fetchTradeData() {
            try {
                const response = await fetch('https://cg-ashy-eta.vercel.app/api/get_trades.js');
                const data = await response.json();
                
                if (data.status === 'success' && data.latest) {
                    currentData = data.latest;
                    updateDashboard(currentData);
                    updateStatus(true);
                } else {
                    updateStatus(false);
                }
            } catch (error) {
                console.error('Fetch error:', error);
                updateStatus(false);
            }
        }
        
        // Update Dashboard
        function updateDashboard(data) {
            // Update stats
            document.getElementById('equity').textContent = `$${data.equity.toFixed(2)}`;
            document.getElementById('balance').textContent = `$${data.balance.toFixed(2)}`;
            document.getElementById('profit').textContent = `$${data.profit.toFixed(2)}`;
            document.getElementById('openTrades').textContent = data.open_trades || 0;
            document.getElementById('mlConfidence').textContent = `${(data.ml_confidence * 100).toFixed(0)}%`;
            document.getElementById('mlTrained').textContent = data.ml_trained || 0;
            document.getElementById('currentSymbol').textContent = data.symbol;
            
            // Update profit color
            const profitEl = document.getElementById('profit');
            profitEl.className = `stat-value ${data.profit >= 0 ? 'positive' : 'negative'}`;
            
            // Update trades list
            updateTradesList(data.trades || []);
            
            // Update chart
            generateChartData(data.symbol, data.current_price);
            
            // Update timestamp
            const now = new Date();
            document.getElementById('lastUpdate').textContent = now.toLocaleTimeString();
        }
        
        // Update Trades List
        function updateTradesList(trades) {
            const list = document.getElementById('tradesList');
            document.getElementById('tradeCount').textContent = trades.length;
            
            if (trades.length === 0) {
                list.innerHTML = `
                    <div style="text-align: center; color: #8b92b0; padding: 40px;">
                        <i class="fas fa-box-open" style="font-size: 48px; margin-bottom: 10px;"></i><br>
                        No active trades
                    </div>
                `;
                return;
            }
            
            list.innerHTML = '';
            
            trades.forEach(trade => {
                const profitUsd = parseFloat(trade.profit || 0);
                const tradeType = trade.type.toUpperCase();
                const profitClass = profitUsd >= 0 ? 'positive' : 'negative';
                
                const item = document.createElement('div');
                item.className = `trade-item ${tradeType.toLowerCase()}`;
                item.innerHTML = `
                    <div>
                        <span class="trade-type ${tradeType.toLowerCase()}">${tradeType}</span>
                        <div style="margin-top: 8px; font-size: 13px;">
                            <strong>${trade.lots} lots</strong> | 
                            Open: ${trade.open_price} | 
                            Current: ${trade.current_price}
                        </div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-size: 18px; font-weight: 700;" class="${profitClass}">
                            ${profitUsd >= 0 ? '+' : ''}$${Math.abs(profitUsd).toFixed(2)}
                        </div>
                        <div style="font-size: 12px; color: #8b92b0;">
                            ${trade.comment || ''}
                        </div>
                    </div>
                `;
                list.appendChild(item);
            });
        }
        
        // Generate Chart Data
        function generateChartData(symbol, currentPrice) {
            if (!currentPrice || currentPrice === 0) return;
            
            const data = [];
            const now = Math.floor(Date.now() / 1000);
            let price = currentPrice;
            
            // Generate 100 candles
            for (let i = 99; i >= 0; i--) {
                const time = now - (i * 60); // 1 minute candles
                const change = (Math.random() - 0.5) * 0.002;
                const newPrice = price * (1 + change);
                
                const open = price;
                const close = newPrice;
                const high = Math.max(open, close) * (1 + Math.random() * 0.001);
                const low = Math.min(open, close) * (1 - Math.random() * 0.001);
                
                data.push({
                    time: time,
                    open: open,
                    high: high,
                    low: low,
                    close: close
                });
                
                price = close;
            }
            
            // Set last candle to current price
            data[data.length - 1].close = currentPrice;
            data[data.length - 1].high = Math.max(data[data.length - 1].high, currentPrice);
            data[data.length - 1].low = Math.min(data[data.length - 1].low, currentPrice);
            
            candlestickSeries.setData(data);
            chart.timeScale().fitContent();
        }
        
        // Update Status
        function updateStatus(online) {
            const badge = document.getElementById('statusBadge');
            const status = document.getElementById('connectionStatus');
            
            if (online) {
                badge.innerHTML = '<i class="fas fa-check-circle"></i> ONLINE';
                badge.className = 'status-badge online';
                status.textContent = 'ONLINE';
                status.className = 'stat-value positive';
            } else {
                badge.innerHTML = '<i class="fas fa-times-circle"></i> OFFLINE';
                badge.className = 'status-badge offline';
                status.textContent = 'OFFLINE';
                status.className = 'stat-value negative';
            }
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            initChart();
            fetchTradeData();
            
            // Auto refresh every 5 seconds
            setInterval(fetchTradeData, 5000);
        });
    </script>
</body>
</html>
